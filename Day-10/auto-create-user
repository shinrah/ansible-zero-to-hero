---
- name: create a user group 
  hosts: webserver
  become: yes
  vars_prompt:
    - name: username
      prompt: "enter username"
      private: no 
    - name: user_password
      prompt: "enter user password"
      private: yes
    - name: user_group
      prompt: "enter group name"
      private: no
  tasks:

    - name: create a group 
      group: 
        name: "{{ user_group }}"
        state: present

    - name: create a user 
      user: 
        name: "{{ username }}"
        state: present
        groups: "{{ user_group }}"
        shell: /bin/bash
        comment: "this is test user"
        password: "{{ user_password  | password_hash('sha512') }}"
        update_password: on_create
        create_home: yes
        home: /home/"{{ username }}"
        expires:  1767139200
        append: yes

    - name: add user to sudoers file
      copy:
        content: "{{ username }} ALL=(ALL) NOPASSWD:ALL"
        dest: /etc/sudoers.d/{{ username }}
        mode: '0400'
        owner: root
        group: root
